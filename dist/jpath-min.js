(function(){var e=this.jPath=this.JPath=function(a,c){this.json=a;this._parent=c};$.extend(e.prototype,{json:null,parent:null,$:function(a){var c=null,b=this;if(this.json&&a!==null)switch(typeof a){case "function":c=this.f(a).json;break;case "number":c=this.json[a]||null;break;case "string":c=a.split("/");for(var d=0;d<c.length;d++){var g=RegExp("^"+c[d].replace(/\*/g,".*")+"$"),i=b.json instanceof Array,f=[],h;for(h in b.json)if(typeof b.json[h]!="function")if(i&&arguments.callee.caller!=this.$$)f=
f.concat(this.findAllByRegExp(g,b.json[h]));else g.test(h)&&f.push(b.json[h]);b=new e(f.length==0?null:f.length==1?f[0]:f,b)}return b}return new e(c,this)},$$:function(a){var c=this.$(a,true).json,b=[];if(c instanceof Array)b=b.concat(c);else c!==null&&b.push(c);for(var d in this.json)if(typeof this.json[d]=="object")b=b.concat((new e(this.json[d],this)).$$(a).json);return new e(b,this)},findAllByRegExp:function(a,c){var b=[],d;for(d in c)if(c instanceof Array)b=b.concat(this.findAllByRegExp(a,c[d]));
else typeof c[d]!="function"&&a.test(d)&&b.push(c[d]);return b},query:function(a){for(var c={" and ":" && "," or ":" || ","([\\#\\*\\@a-z\\_][\\*a-z0-9_\\-]*)(?=(?:\\s|$|\\[|\\]|\\/))":"$('$1').","\\[([0-9])+\\]":"$($1).","\\.\\.":"parent().","//":"$","(^|\\[|\\s)\\/":"$1root().","\\/":"","([^\\=\\>\\<\\!])\\=([^\\=])":"$1==$2","\\[":"$(function(j){ with(j){return(","\\]":");}}).","\\(\\.":"(","(\\.|\\])(?!\\$|\\p)":"$1json","count\\(([^\\)]+)\\)":"count('$1')"},b=/(\'|\")([^\1]*)\1/,d=[];b.test(a);){d.push(a.match(b)[2]);
a=a.replace(b,"%"+(d.length-1)+"%")}for(var g in c)a=a.replace(RegExp(g,"ig"),c[g]);return eval("this."+a.replace(/\%(\d+)\%/g,"saves[$1]")+";")},f:function(a){var c=[];typeof a=="string"&&eval("iterator = function(j){with(j){return("+a+");}}");for(var b in this.json){var d=new e(this.json[b],this);d.index=b;a(d)&&c.push(this.json[b])}return new e(c,this)},parent:function(){return this._parent?this._parent:this},position:function(){return this.index},last:function(){return this.index==this._parent.json.length-
1},count:function(a){return(a=this.$(a||"*").json)?a instanceof Array?a.length:1:0},root:function(){return this._parent?this._parent.root():this}})})();
